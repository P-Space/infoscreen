#!/usr/bin/env python

from BaseHTTPServer import BaseHTTPRequestHandler, HTTPServer
import urlparse
from sh import vcgencmd

def lights(status):
    if "off" in status:
        vcgencmd("display_power", "0")
    elif "on" in status:
        vcgencmd("display_power", "1")

class MyHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        print("Just received a GET request")
        parsed_path = urlparse.urlparse(self.path)
        params = urlparse.parse_qs(parsed_path.query)
        try:
            lights(params['lights'][0])
        except KeyError:
            pass
        self.send_response(200)
        self.send_header("Content-type", "text/html")
        self.end_headers()
        self.wfile.write('Hello world')
        return

if __name__ == "__main__":
    try:
        server = HTTPServer(('192.168.1.32', 80), MyHandler)
        print('Started http server')
        server.serve_forever()
    except KeyboardInterrupt:
        print('^C received, shutting down server')
        server.socket.close()
